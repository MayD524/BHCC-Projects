#:kivy 2.1.0
#:import Factory kivy.factory.Factory

<HistoryPopup>
    auto_dismiss: True
    size_hint: 0.6, 0.5
    pos_hint: {"x": 0.2, "top": 0.9}
    title: "History"
    id: popup
    
    BoxLayout:
        orientation: "vertical"
        size: root.width, root.height
        id: bl
        ScrollView:
            do_scroll_x: False
            do_scoroll_y: True
            Label:
                size_hint_y: None
                padding: 10, 10
                id: data_label
                text: "History"
                font_size: 20
        Button:
            size_hint: 0.2, 0.1
            text: "Close"
            font_size: 24
            on_release: root.dismiss()


<CButton@Button>:
    font_size: 32

<CalcLayout>:
    id: calculator
    display: entry
    rows: 6
    padding: 10
    spacing: 10
    screen_orientation: 'landscape' if self.width > self.height else 'portrait'
    BoxLayout:
        TextInput:
            id: entry
            font_size: 32
            multiline: False
    
    BoxLayout:
        orientation: 'vertical'
        disabled: root.screen_orientation != 'portrait'

        size_hint: (None, None) if self.disabled else (1,1)
        size: (0,0) if self.disabled else (100,100)
        opacity: 0 if self.disabled else 1
    
        # When buttons are pressed update the entry
        BoxLayout:
            spacing: 10
            CButton:
                text: "7"
                on_press: entry.text += self.text
            CButton:
                text: "8"
                on_press: entry.text += self.text
            CButton:
                text: "9"
                on_press: entry.text += self.text
            CButton:
                text: "+"
                on_press: entry.text += self.text
    
        BoxLayout:
            spacing: 10
            CButton:
                text: "4"
                on_press: entry.text += self.text
            CButton:
                text: "5"
                on_press: entry.text += self.text
            CButton:
                text: "6"
                on_press: entry.text += self.text
            CButton:
                text: "-"
                on_press: entry.text += self.text
    
        BoxLayout:
            spacing: 10
            CButton:
                text: "1"
                on_press: entry.text += self.text
            CButton:
                text: "2"
                on_press: entry.text += self.text
            CButton:
                text: "3"
                on_press: entry.text += self.text
            CButton:
                text: "*"
                on_press: entry.text += self.text
    
        # When equals is pressed pass text in the entry
        # to the calculate function
        BoxLayout:
            spacing: 10
            CButton:
                text: "AC"
                on_press: entry.text = ""
            CButton:
                text: "0"
                on_press: entry.text += self.text
            CButton:
                text: "="
                on_press: calculator.calculate(entry.text)
            CButton:
                text: "/"
                on_press: entry.text += self.text
        BoxLayout:
            CButton:
                font_size: 20
                text: "History"
                on_press: 
                    Factory.HistoryPopup().open()
    
    BoxLayout:
        orientation: 'vertical'
        disabled: root.screen_orientation != 'landscape'
        size_hint: (None, None) if self.disabled else (1,1)
        size: (0,0) if self.disabled else (100,100)
        opacity: 0 if self.disabled else 1

        # When buttons are pressed update the entry
        BoxLayout:
            orientation: "vertical"
            BoxLayout:
                spacing: 10
                CButton:
                    text: "log"
                    on_press: root.log()

                CButton:
                    text: "ln"
                    on_press: root.ln()

                CButton:
                    text: "x^2"
                    on_press: entry.text += "**2"
                CButton:
                    text: "x^n"
                    on_press: entry.text += "**"
                CButton:
                    text: "2√(n)"
                    on_press: root.addSqrt()
                CButton:
                    text: "n√(x)"
                    on_press: root.nthRoot()
            BoxLayout:
                spacing: 10
                CButton:
                    text: "7"
                    on_press: entry.text += self.text
                CButton:
                    text: "8"
                    on_press: entry.text += self.text
                CButton:
                    text: "9"
                    on_press: entry.text += self.text
                CButton:
                    text: "+"
                    on_press: entry.text += self.text
        
            BoxLayout:
                spacing: 10
                CButton:
                    text: "4"
                    on_press: entry.text += self.text
                CButton:
                    text: "5"
                    on_press: entry.text += self.text
                CButton:
                    text: "6"
                    on_press: entry.text += self.text
                CButton:
                    text: "-"
                    on_press: entry.text += self.text
        
            BoxLayout:
                spacing: 10
                CButton:
                    text: "1"
                    on_press: entry.text += self.text
                CButton:
                    text: "2"
                    on_press: entry.text += self.text
                CButton:
                    text: "3"
                    on_press: entry.text += self.text
                CButton:
                    text: "*"
                    on_press: entry.text += self.text
        
            # When equals is pressed pass text in the entry
            # to the calculate function
            BoxLayout:
                spacing: 10
                CButton:
                    text: "AC"
                    on_press: entry.text = ""
                CButton:
                    text: "0"
                    on_press: entry.text += self.text
                CButton:
                    text: "="
                    on_press: calculator.calculate(entry.text)
                CButton:
                    text: "/"
                    on_press: entry.text += self.text
        BoxLayout:
            CButton:
                font_size: 20
                text: "History"
                size_hint: 1, 0.3
                on_press: 
                    Factory.HistoryPopup().open()